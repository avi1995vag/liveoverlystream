<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced News Overlay</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Anek+Kannada:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        :root {
            --panel-bg: rgba(20, 20, 25, 0.4);
            --text-light: #ffffff;
            --text-shadow: 0 1px 3px rgba(0,0,0,0.6);
        }
        body { margin: 0; font-family: 'Anek Kannada', sans-serif; background-color: transparent; color: var(--text-light); overflow: hidden; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        @keyframes gradientShift { 0%{background-position:0% 50%} 50%{background-position:100% 50%} 100%{background-position:0% 50%} }
        @keyframes scroll-left { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        .ticker-tape {
            position: absolute; bottom: 50px; left: 0; width: 100%; height: 75px; /* Ticker Increased Height */
            background: linear-gradient(90deg, #0052d4, #4364f7, #6fb1fc, #4364f7, #0052d4);
            background-size: 400% 400%; animation: gradientShift 15s ease infinite, fadeIn 1s ease-out;
            overflow: hidden; display: flex; align-items: center;
        }
        .ticker-content { display: inline-block; white-space: nowrap; padding-left: 100%; animation: scroll-left 50s linear infinite; }
        .ticker-item { display: inline-flex; align-items: center; font-weight: 700; margin: 0 40px; text-transform: uppercase; font-size: 28px; text-shadow: var(--text-shadow); }
        .ticker-item i { margin-right: 15px; font-size: 30px; }
        .ticker-separator { display: inline-block; height: 40px; border-left: 3px solid rgba(255,255,255,0.4); vertical-align: middle; margin: 0 15px; }

        .right-panel {
            position: absolute; top: 0; right: 0; width: 320px; /* Sidebar Width Decreased */
            height: 100%; display: flex; flex-direction: column;
            padding: 15px; box-sizing: border-box;
            background-image: repeating-linear-gradient(45deg, transparent, transparent 2px, rgba(0, 0, 0, 0.1) 2px, rgba(0, 0, 0, 0.1) 4px), linear-gradient(to bottom, #7d2607, #d56c0b 50%, #5a1d05);
            opacity: 0; animation: fadeIn 0.7s ease-out 0.2s forwards;
        }
        
        .info-card {
            background: var(--panel-bg); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; padding: 20px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
            flex-grow: 1; position: relative;
            opacity: 0; animation: slideUp 0.7s ease-out forwards;
        }
        
        .rotating-panel {
            position: absolute; width: 100%; height: 100%; top: 0; left: 0;
            opacity: 0; visibility: hidden; transition: opacity 0.6s ease-in-out, visibility 0.6s;
            display: flex; flex-direction: column;
        }
        .panel-active { opacity: 1; visibility: visible; }

        .card-header { display: inline-flex; align-items: center; padding: 8px 18px; border-radius: 50px; font-weight: 700; text-transform: uppercase; margin-bottom: 20px; font-size: 22px; }
        .card-header i { margin-right: 12px; }
        #weather-panel .card-header { background: linear-gradient(to right, #00c6ff, #0072ff); }
        #dam-panel .card-header { background: linear-gradient(to right, #08aeea, #2af598); }

        .showcase-content { text-align: center; flex-grow: 1; display: flex; flex-direction: column; justify-content: center; transition: opacity 0.5s ease-in-out; }

        /* --- WEATHER STYLES --- */
        #weather-city { font-size: 28px; font-weight: 700; margin-bottom: 10px; }
        #weather-icon { width: 100px; height: 100px; margin: 0 auto; filter: drop-shadow(0 0 10px #000); }
        #weather-temp { font-size: 60px; font-weight: 700; line-height: 1; margin: 10px 0; }
        #weather-details { display: flex; justify-content: space-around; font-size: 16px; margin-top: 15px; }
        #weather-details > div { display: flex; flex-direction: column; align-items: center; }
        #weather-details i { font-size: 20px; margin-bottom: 5px; }

        /* --- DAM STYLES --- */
        #dam-name { font-size: 28px; font-weight: 700; margin-bottom: 20px; }
        #dam-percentage { font-size: 60px; font-weight: 700; line-height: 1; margin-bottom: 15px; }
        #dam-percentage span { font-size: 30px; font-weight: 400; }
        .progress-bar-container { height: 25px; background-color: rgba(0,0,0,0.3); border-radius: 25px; overflow: hidden; margin: 0 10px 20px 10px; border: 1px solid rgba(255,255,255,0.2); }
        .progress-bar { width: 0%; height: 100%; background: linear-gradient(to right, #00c6ff, #0072ff); border-radius: 25px; transition: width 1s ease-out; }
        #dam-levels { font-size: 18px; }

    </style>
</head>
<body>
    <div class="news-overlay">
        <div class="ticker-tape"><div class="ticker-content" id="ticker-content">Loading Ticker...</div></div>
        
        <div class="right-panel">
            <div class="info-card">
                <div class="rotating-panel" id="weather-panel">
                    <div class="card-header"><i class="fa-solid fa-cloud-sun"></i> Weather Report</div>
                    <div class="showcase-content" id="weather-showcase">Loading Weather...</div>
                </div>
                <div class="rotating-panel" id="dam-panel">
                    <div class="card-header"><i class="fa-solid fa-water"></i> Dam Water Levels</div>
                    <div class="showcase-content" id="dam-showcase">Loading Dam Levels...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===================================================================
        // ===               CONFIGURATION & DATA SECTION                  ===
        // ===================================================================
        const GIST_ID = '34f940d8007a0a2180f12dc5984b536f'; // <-- PASTE YOUR GIST ID HERE
        const WEATHER_API_KEY = 'df00118525464de4b0c34915251805'; // <-- PASTE YOUR WEATHERAPI KEY HERE

        const CITIES_FOR_WEATHER = ['Bengaluru', 'Mysuru', 'Belagavi', 'Hubballi', 'Mangaluru', 'Shivamogga', 'Ballari', 'Bidar'];
        const CITY_NAME_MAP = {
            'Bengaluru': 'ಬೆಂಗಳೂರು', 'Mysuru': 'ಮೈಸೂರು', 'Belagavi': 'ಬೆಳಗಾವಿ', 'Hubballi': 'ಹುಬ್ಬಳ್ಳಿ',
            'Mangaluru': 'ಮಂಗಳೂರು', 'Shivamogga': 'ಶಿವಮೊಗ್ಗ', 'Ballari': 'ಬಳ್ಳಾರಿ', 'Bidar': 'ಬೀದರ್'
        };

        const ROTATION_INTERVAL_MS = 6000;  // Rotate content every 6 seconds
        const DATA_REFRESH_INTERVAL_MS = 5 * 60 * 1000; // Refresh data from Gist every 5 minutes
        
        // ===================================================================
        // ===                    APPLICATION LOGIC                        ===
        // ===================================================================
        
        let appData = {};
        let weatherDataCache = [];
        
        let currentMode = 'weather'; // 'weather' or 'dams'
        let weatherIndex = 0;
        let damIndex = 0;

        async function fetchGistData() {
            if (!GIST_ID || GIST_ID === 'YOUR_GIST_ID_HERE') {
                console.error("Gist ID is not configured.");
                return null;
            }
            const url = `https://api.github.com/gists/${GIST_ID}`;
            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error(`Gist API Error: ${response.statusText}`);
                const gistData = await response.json();
                return JSON.parse(gistData.files['data.json'].content);
            } catch (error) {
                console.error('Error fetching Gist data:', error);
                return null;
            }
        }
        
        async function fetchWeatherData() {
            weatherDataCache = [];
            if (!WEATHER_API_KEY || WEATHER_API_KEY.includes('YOUR_')) {
                console.error("Weather API Key missing.");
                return;
            }
            for (const city of CITIES_FOR_WEATHER) {
                const url = `https://api.weatherapi.com/v1/current.json?key=${WEATHER_API_KEY}&q=${city}&aqi=no`;
                try {
                    const response = await fetch(url);
                    if (response.ok) {
                        weatherDataCache.push(await response.json());
                    } else { throw new Error(`Weather fetch failed for ${city}`); }
                } catch (error) { console.error(error); }
            }
        }

        function updateTicker() {
            const { gold_22k, gold_24k, silver_kg, petrol, diesel } = appData;
            const tickerItems = `
                <div class="ticker-item"><i class="fa-solid fa-coins" style="color: #ffd700;"></i>22k Gold: ₹${gold_22k}/g</div><div class="ticker-separator"></div>
                <div class="ticker-item"><i class="fa-solid fa-circle" style="color: #ffec8b;"></i>24k Gold: ₹${gold_24k}/g</div><div class="ticker-separator"></div>
                <div class="ticker-item"><i class="fa-solid fa-database" style="color: #e0e0e0;"></i>Silver: ₹${silver_kg}/kg</div><div class="ticker-separator"></div>
                <div class="ticker-item"><i class="fa-solid fa-gas-pump" style="color: #e52d27;"></i>Petrol: ₹${petrol}</div><div class="ticker-separator"></div>
                <div class="ticker-item"><i class="fa-solid fa-truck-droplet" style="color: #f7b733;"></i>Diesel: ₹${diesel}</div>`;
            document.getElementById('ticker-content').innerHTML = tickerItems.repeat(4);
        }

        function updateWeatherDisplay() {
            if (weatherDataCache.length === 0) return;
            const data = weatherDataCache[weatherIndex];
            const showcase = document.getElementById('weather-showcase');
            showcase.style.opacity = 0;
            setTimeout(() => {
                showcase.innerHTML = `
                    <div id="weather-city">${CITY_NAME_MAP[data.location.name] || data.location.name}</div>
                    <img id="weather-icon" src="https:${data.current.condition.icon}" alt="${data.current.condition.text}">
                    <div id="weather-temp">${Math.round(data.current.temp_c)}°</div>
                    <div id="weather-details">
                        <div><i class="fa-solid fa-temperature-three-quarters"></i>${Math.round(data.current.feelslike_c)}°</div>
                        <div><i class="fa-solid fa-droplet"></i>${data.current.humidity}%</div>
                        <div><i class="fa-solid fa-wind"></i>${Math.round(data.current.wind_kph)} kph</div>
                    </div>
                `;
                showcase.style.opacity = 1;
            }, 500);
        }
        
        function updateDamDisplay() {
            if (!appData.dams || appData.dams.length === 0) return;
            const dam = appData.dams[damIndex];
            const percentage = ((dam.current / dam.max) * 100).toFixed(1);
            const showcase = document.getElementById('dam-showcase');
            
            showcase.style.opacity = 0;
            setTimeout(() => {
                showcase.innerHTML = `
                    <div id="dam-name">${dam.name}</div>
                    <div id="dam-percentage">${percentage}<span>%</span></div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" style="width: ${percentage}%;"></div>
                    </div>
                    <div id="dam-levels">Current: ${dam.current} / Max: ${dam.max}</div>
                `;
                showcase.style.opacity = 1;
            }, 500);
        }
        
        function advanceRotation() {
            if (currentMode === 'weather') {
                updateWeatherDisplay();
                weatherIndex++;
                if (weatherIndex >= weatherDataCache.length) {
                    weatherIndex = 0;
                    currentMode = 'dams'; // Switch to dams
                    document.getElementById('weather-panel').classList.remove('panel-active');
                    document.getElementById('dam-panel').classList.add('panel-active');
                }
            } else if (currentMode === 'dams') {
                updateDamDisplay();
                damIndex++;
                if (damIndex >= appData.dams.length) {
                    damIndex = 0;
                    currentMode = 'weather'; // Switch back to weather
                    document.getElementById('dam-panel').classList.remove('panel-active');
                    document.getElementById('weather-panel').classList.add('panel-active');
                }
            }
        }

        async function initialize() {
            document.getElementById('weather-panel').classList.add('panel-active');
            
            const [gistResult, weatherResult] = await Promise.all([
                fetchGistData(),
                fetchWeatherData()
            ]);

            if (gistResult) {
                appData = gistResult;
                updateTicker();
                if (!appData.dams || appData.dams.length === 0) { // If no dams, stay on weather
                    currentMode = 'weather';
                }
            }
            
            advanceRotation(); // Initial display
            setInterval(advanceRotation, ROTATION_INTERVAL_MS);
            
            setInterval(async () => {
                const latestGistData = await fetchGistData();
                if(latestGistData) appData = latestGistData;
                await fetchWeatherData();
                updateTicker();
            }, DATA_REFRESH_INTERVAL_MS);
        }

        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
